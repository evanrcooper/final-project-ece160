// Real programmers don't comment their code.
// If it was hard to write, it should be hard to understand.
/*
  ░░      ░░        ░░░░    ▓▓██████████████████████████                              
░░░░██▓▓▓▓              ████░░░░░░░░░░░░░░░░░░░░░░░░░░░░████                          
░░▓▓░░░░▒▒████▓▓    ████░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░██▓▓                      
  ██▓▓░░░░░░░░▒▒████░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░▓▓      ░░████████████
░░▓▓░░▓▓░░░░░░▒▒██░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░▓▓░░██▓▓░░░░░░░░░░██
░░▓▓░░▓▓░░░░▒▒▓▓░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░▓▓░░░░░░░░░░░░████
░░▓▓░░░░▓▓▒▒▓▓░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░▓▓░░░░▒▒░░██░░██
░░▓▓░░░░░░▓▓░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░▓▓░░░░░░▓▓░░░░██
░░▓▓░░░░░░▓▓░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░▓▓░░░░░░░░░░░░▓▓░░░░██░░░░██
░░▓▓░░░░▓▓░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░▓▓░░░░░░░░░░▓▓▒▒██░░░░░░██
  ░░▓▓░░▓▓░░░░░░░░░░░░██░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░██░░░░░░░░░░▒▒▓▓██░░░░██  
  ░░▓▓░░▓▓░░░░░░░░░░░░▓▓░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░▓▓░░░░░░░░░░██░░░░░░██  
    ░░▓▓░░░░░░░░░░░░████░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░██░░░░░░░░░░▓▓░░░░██    
    ░░▓▓░░░░░░░░░░░░████░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░▓▓░░░░░░░░░░▓▓░░░░██    
  ░░░░▓▓░░  ░░░░░░██  ██░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░▓▓░░░░░░░░▒▒▓▓██      
    ░░▓▓░░░░░░░░░░██  ██░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░▓▓░░░░░░░░▒▒██  ░░    
  ░░▓▓░░░░░░░░░░░░██  ▓▓░░░░  ░░░░  ░░░░░░░░▓▓░░░░░░░░░░░░░░░░░░▓▓░░░░░░░░▒▒▓▓  ░░    
  ░░▓▓░░░░░░░░▒▒▓▓    ██░░░░░░░░░░░░░░░░░░░░██░░░░░░░░░░░░░░░░░░▓▓░░░░░░░░▒▒██        
  ░░▓▓░░░░░░░░▒▒██░░  ██░░░░░░░░░░░░░░░░░░░░░░██░░░░░░░░░░░░░░░░░░▓▓░░░░░░▒▒██        
  ░░▓▓░░░░░░░░▒▒██      ██░░░░░░░░░░░░░░░░░░░░██░░░░░░░░░░░░░░░░▒▒▓▓░░░░░░▒▒██        
  ░░▓▓░░░░░░▒▒▒▒░░  ░░  ██░░░░░░░░░░░░░░░░░░░░██░░░░░░░░░░░░░░░░▒▒▓▓░░░░░░▒▒██        
  ░░▓▓░░░░░░▒▒▓▓░░      ██░░░░░░░░░░░░░░░░░░▒▒░░██░░░░░░░░░░░░░░▒▒▓▓░░░░░░▒▒██        
  ░░██░░░░░░▒▒▓▓        ░░▓▓░░▒▒░░░░░░░░░░░░░░░░██░░░░░░░░░░░░░░▒▒▓▓░░░░░░▒▒██        
  ░░██░░░░░░▒▒▓▓░░        ██▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓██▓▓▓▓▓▓▓▓▓▓░░░░▒▒██░░░░░░▒▒██        
  ░░▓▓░░░░▒▒▓▓▓▓░░▓▓▓▓▓▓▓▓▓▓                ░░    ▓▓▓▓▓▓▓▓▓▓▓▓▓▓░░▓▓░░░░░░▒▒██        
  ░░▓▓▒▒▒▒▒▒▓▓░░▓▓▓▓▓▓▓▓▓▓▓▓                      ▓▓▓▓▓▓▓▓▓▓▓▓  ▓▓▓▓░░▒▒▒▒▒▒██        
  ░░▓▓▒▒▒▒▒▒██▓▓▓▓▓▓▓▓▓▓▓▓▓▓                      ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓░░▒▒▒▒▒▒██        
  ░░▓▓▒▒▒▒▒▒▓▓▒▒  ▓▓▓▓▓▓▓▓▓▓                      ▓▓▓▓▓▓▓▓▓▓  ▓▓▓▓░░▒▒▒▒▒▒▒▒██        
  ░░▓▓▒▒░░▒▒▓▓    ▓▓▓▓▓▓▓▓▓▓                      ▓▓▓▓▓▓▓▓▓▓    ▓▓░░▒▒░░░░▒▒██        
  ░░▓▓▒▒▒▒▒▒▓▓    ▓▓░░░░░░▓▓                      ▓▓░░░░░░▓▓    ▓▓▒▒▒▒▒▒▒▒▒▒██        
  ░░▓▓▒▒▒▒▒▒▓▓░░░░░░▓▓▓▓▓▓                          ▓▓▓▓▓▓░░░░░░▓▓▒▒▒▒▒▒▒▒▒▒██        
    ▓▓▒▒▒▒▒▒▓▓░░░░░░░░░░░░                          ░░░░░░░░░░░░▓▓▒▒▒▒▒▒▒▒▒▒██        
  ░░▓▓▒▒▒▒▒▒▒▒▒▒  ░░                              ░░      ░░░░▓▓▒▒▒▒▒▒▒▒▒▒▓▓██        
    ▓▓▒▒▒▒▒▒▒▒▓▓                  ▓▓▒▒    ░░              ░░  ▓▓▒▒▒▒▒▒▒▒▒▒▒▒██        
  ░░▓▓▒▒▒▒▒▒▒▒▒▒▓▓            ▓▓▓▓░░░░▓▓░░                  ▓▓▒▒▒▒▒▒▒▒▒▒▒▒▒▒██        
  ░░▓▓▒▒▒▒▒▒▒▒▒▒▒▒▓▓▓▓      ▓▓░░░░▓▓  ░░▒▒              ▓▓▓▓▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒██        
  ░░▓▓▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▓▓▓▓▓▓░░░░░░░░▓▓░░▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒██        
    ░░▓▓▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒██░░░░░░░░░░▓▓    ██▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒██        
    ░░▓▓▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▓▓░░░░░░░░░░░░▓▓    ██▓▓▓▓▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒██        
    ░░▓▓▒▒▒▒▒▒▒▒▒▒▒▒▒▒██░░░░░░░░░░░░░░▓▓░░▓▓      ████▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒██        
    ░░██▒▒▒▒▒▒▒▒▒▒▒▒▒▒██░░░░░░░░░░░░▓▓  ▓▓          ██▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▓▓▒▒██        
    ░░▓▓▒▒▒▒▒▒▒▒▒▒▒▒██░░░░░░░░░░░░░░██▓▓░░██      ██░░██▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▓▓▒▒██        
    ░░▓▓▒▒▒▒▓▓▒▒▒▒▒▒██░░░░░░░░░░░░▓▓▓▓      ██  ██░░░░██▒▒▒▒▒▒▒▒▒▒▒▒▒▒██▓▓▓▓██        
    ░░▓▓▒▒▒▒▓▓▒▒▒▒▒▒██░░░░░░░░░░░░▓▓▓▓      ████░░░░░░░░██▒▒▒▒▒▒▒▒▒▒▒▒▓▓▓▓▒▒██        
      ░░▓▓▒▒██▓▓▒▒▒▒██░░░░░░░░░░▓▓░░░░▓▓░░██░░░░░░░░░░░░██▒▒▒▒▒▒▒▒▒▒▓▓░░▓▓▒▒██        
        ▓▓▒▒▓▓▓▓▒▒▒▒██░░░░░░░░░░██░░░░▓▓░░██░░░░░░░░██░░██▒▒▒▒▒▒▒▒▒▒▓▓░░▓▓▓▓██        
      ░░▓▓▒▒▓▓░░██▒▒▒▒██░░░░░░██░░░░░░░░▓▓░░░░░░░░░░██░░░░██▒▒▒▒▒▒▓▓░░▓▓▒▒▓▓          
      ░░▓▓▒▒▓▓░░▓▓▒▒▒▒▒▒██████░░░░░░░░░░▓▓░░░░░░░░░░██░░░░▓▓▒▒▒▒▒▒▓▓░░██▒▒▒▒          
        ░░▓▓▓▓  ░░██▒▒▒▒▒▒██░░░░░░░░░░░░▓▓░░░░░░░░░░██░░░░██▒▒▒▒▓▓  ░░▓▓▒▒▓▓          
          ░░▓▓    ░░▓▓▒▒▒▒██░░░░░░░░░░░░▓▓░░▓▓░░░░░░░░▓▓░░░░▓▓▓▓░░  ░░▓▓▓▓░░          
            ░░▒▒    ░░▓▓▓▓▓▓░░░░░░░░░░░░▓▓░░░░░░░░░░░░██░░░░▓▓░░    ░░▓▓░░            
            ░░░░▓▓  ░░  ░░██░░░░░░░░░░░░▓▓░░░░░░░░░░░░██░░░░██    ░░▓▓░░              
                        ██░░░░░░░░░░░░▒▒▓▓░░██░░░░░░░░██░░░░░░▓▓░░                    
                        ██░░░░░░░░░░░░░░▓▓░░░░░░░░░░░░██░░░░░░██                      
                        ██░░░░░░░░░░░░▒▒▒▒░░░░░░░░░░░░░░██░░░░░░▓▓                    
                        ▓▓░░░░░░░░░░░░░░▓▓░░░░░░░░░░░░░░██░░░░░░▓▓                    
                        ██░░░░░░░░░░░░░░▓▓░░░░░░░░░░░░░░▓▓██▓▓██▓▓                    
                        ██████████████▓▓▓▓████████████████      ▓▓                    
                      ▓▓▒▒▒▒▒▒▓▓▒▒▒▒▓▓▒▒▒▒▒▒▓▓▒▒▒▒▓▓▒▒▒▒▒▒▓▓██▓▓░░░░                  
                      ▓▓▒▒▒▒▓▓▒▒▒▒▒▒▓▓▒▒▒▒▒▒██▒▒▒▒▒▒▓▓▒▒▒▒██░░░░                      
                      ▓▓▒▒▒▒▓▓▒▒▒▒▒▒▓▓▒▒▒▒▒▒██▒▒▒▒▒▒██▒▒▒▒██                          
                      ██▓▓▓▓██▓▓▓▓▓▓▓▓▓▓██▓▓██▓▓▓▓▓▓██▓▓▓▓██                          
                      ░░░░░░▓▓░░░░░░▓▓░░░░░░██░░░░░░▓▓░░░░░░                          
                            ▓▓      ▓▓      ██      ▓▓                                
                            ██▓▓▓▓▓▓▓▓  ░░  ██▓▓▓▓▓▓██                                
                            ▓▓▒▒▒▒▒▒▓▓      ██▒▒▒▒▒▒██                                
                            ██▒▒▒▒▒▒▓▓░░    ██▒▒▒▒▒▒██                                
                            ██▒▒▒▒▒▒▓▓      ██▒▒▒▒▒▒██                                
                            ██▒▒▒▒▒▒▓▓      ██▒▒▒▒▒▒██                                
                            ▓▓▒▒▒▒▒▒▓▓      ██▒▒▒▒▒▒██                                
                            ▓▓▒▒▒▒▒▒▒▒▓▓░░██▒▒▒▒▒▒▒▒██                                
                            ██▒▒▒▒▒▒▒▒▓▓  ▓▓▒▒▒▒▒▒▒▒██                                
                            ░░██▓▓▓▓██▓▓░░▓▓▓▓▓▓▓▓██░░                                
*/
#include <stdio.h>
#include <stdlib.h>
#include <time.h>
#include <stdbool.h>
#include <ctype.h>

#define DECK_SIZE 108
#define NUM_PLAYERS 2
#define TURNS 15
#define UNO_PUNISHMENT 2

char colors[5][32] = {"Red", "Blue", "Green", "Yellow", "WILD"};

struct card {
	int color;
	char value;
};

struct deck {
	struct card deck[DECK_SIZE];
	int deck_size;
	struct card pile[DECK_SIZE];
	int pile_size;
};

struct hand {
	struct card cards[DECK_SIZE];
	int hand_size;
};

struct player {
	struct hand hand;
	bool uno;
};

struct game {
	struct player players[NUM_PLAYERS];
	struct deck main_deck;
	int current_turn;
	int order;
};

void createDeck(struct deck *deck);
void printDeck(struct deck *deck);
void printPile(struct deck *deck);
void printHand(struct hand *hand);
void printCard(struct card *card);
void printPlayer(struct game *game, int index);
void swapCards(struct deck *deck, int index1, int index2);
void shuffle(struct deck *deck);
struct card draw(struct deck *deck);
void deal(struct game *game);
bool isValidCard(struct deck *deck, struct card *card);
void computeTurn(struct game *game);
void outputGameState(struct game game);
void takeTurn(struct game *game);
struct card handPull(struct hand *hand, int index);
void handDraw(struct deck *deck, struct hand *hand);
int refillDeck(struct deck *deck);
void cardAction(struct game *game);
int unoInt(char text[], bool *uno);
int inputInt(char text[]);
int inputChar(char text[]);
void inputString(char text[], char *str);
void printColors(void);
int nextPlayer(struct game *game);
void amogus(void);

int main() {
	amogus();
	srand(time(0));
	struct deck deck;
	struct game game;
	game.current_turn = 0;
	game.order = 1;
	game.main_deck = deck;
	createDeck(&(game.main_deck));
	shuffle(&(game.main_deck));
	for (int i = 0; i < NUM_PLAYERS; i++) {
		struct player temp_player;
		temp_player.uno = false;
		struct hand temp_hand;
		temp_hand.hand_size = 0;
		temp_player.hand = temp_hand;
		game.players[i] = temp_player;
	}
	deal(&game);
	int tempi = 0;
	outputGameState(game);	
	do {
		takeTurn(&game);
		computeTurn(&game);
		outputGameState(game);
	} while (tempi++ < TURNS*NUM_PLAYERS);
}

int inputInt(char text[]) {
	int temp;
	printf("%s", text);
	if (scanf("%d", &temp) == 1) {;}
	return temp;
}

int inputChar(char text[]) {
	char temp;
	printf("%s", text);
	if (scanf("%c", &temp) == 1) {;}
	return temp;
}

void inputString(char text[], char *str) {
	printf("%s", text);
	if (scanf("%s", str) == 1) {;}
}

void createDeck(struct deck *deck) {
	deck->pile_size = 0;
	int index = 0;
	struct card temp_card;
	for (int i = 0; i < 4; i++) { //4 Colors
		temp_card.color = i;
		for (int j = 0; j < 10; j++) { //0-9
			temp_card.value = j+'0';
			deck->deck[index++] = temp_card;
		}
		for (int j = 1; j < 10; j++) { //1-9
			temp_card.value = j+'0';
			deck->deck[index++] = temp_card;
		}
		temp_card.value = 'S'; //Skip
		deck->deck[index++] = temp_card;
		deck->deck[index++] = temp_card;
		temp_card.value = 'R'; //Revese
		deck->deck[index++] = temp_card;
		deck->deck[index++] = temp_card;
		temp_card.value = '+'; //Draw 2
		deck->deck[index++] = temp_card;
		deck->deck[index++] = temp_card;
	}
	temp_card.color = 4; //Wild Card
	temp_card.value = 'P'; //Draw 4
	for (int i = 0; i < 2; i++) {
		for (int j = 0; j < 4; j++) {
			deck->deck[index++] = temp_card;
		}
		temp_card.value = 'C'; //Color Change
	}
	deck->deck_size = index;
}

void printDeck(struct deck *deck) {
	for (int i = 0; i < deck->deck_size; i++) {
		printf("#%d, Color = %s, Value = %c\n", i, colors[deck->deck[i].color], deck->deck[i].value);
	}
}

void printPile(struct deck *deck) {
	for (int i = 0; i < deck->pile_size; i++) {
		printf("#%d, Color = %s, Value = %c\n", i, colors[deck->pile[i].color], deck->pile[i].value);
	}
}

void printHand(struct hand *hand) {
	for (int i = 0; i < hand->hand_size; i++) {
		printf("#%d, Color = %s, Value = %c\n", i, colors[hand->cards[i].color], hand->cards[i].value);
	}
}

void printCard(struct card *card) {
	printf("Color = %s, Value = %c\n", colors[card->color], card->value);
}

void printPlayer(struct game *game, int index) {
	if (index >= NUM_PLAYERS || index < 0) {
		printf("Error: Index Out Of Bounds\n");
		return;
	}
	printf("Player %d's Hand:\n", index);
	printHand(&(game->players[index].hand));
}

void swapCards(struct deck *deck, int index1, int index2) {
	struct card temp_card = deck->deck[index1];
	deck->deck[index1] = deck->deck[index2];
	deck->deck[index2] = temp_card;
}

void shuffle(struct deck *deck) {
	for (int i = 0; i < deck->deck_size; i++) {	
		swapCards(deck, i, rand()%deck->deck_size);
	}
}

struct card draw(struct deck *deck) {
	deck->deck_size -= 1;
	return deck->deck[deck->deck_size];
}

void deal(struct game *game) {
	for (int i = 0; i < NUM_PLAYERS; i++) {
		for (int j = 0; j < 7; j++) {
			game->players[i].hand.cards[game->players[i].hand.hand_size++] = draw(&(game->main_deck));
		}
	}
	game->main_deck.pile[game->main_deck.pile_size++] = draw(&(game->main_deck));
}

bool isValidCard(struct deck *deck, struct card *card) {
	if (deck->pile[deck->pile_size-1].color == card->color) {
		return true;
	} else if (deck->pile[deck->pile_size-1].value == card->value) {
		return true;
	} else if (card->color == 4 || deck->pile[deck->pile_size-1].color == 4) {
		return true;
	}
	return false;
}

void computeTurn(struct game *game) {
	game->current_turn += game->order;
	if (game->current_turn < 0) {
		game->current_turn = NUM_PLAYERS-1;
	} else if (game->current_turn >= NUM_PLAYERS) {
		game->current_turn = 0;
	}
}

void outputGameState(struct game game) {
	for (int i = 0; i < NUM_PLAYERS; i++) {
		printf("Player #%d's Hand:\n", i);
		for (int j = 0; j < game.players[i].hand.hand_size; j++) {
			printf("Card #%d: %s %c\n", j, colors[game.players[i].hand.cards[j].color], game.players[i].hand.cards[j].value);
		}
		printf("\n");
	}
	printf("Player %d's turn.\n", game.current_turn);
	if (game.order == 1) {
		printf("The turn order is forwards.\n");
	} else if (game.order == -1) {
		printf("The turn order is backwards.\n");
	}
	printf("There are/is currently %d card(s) left in the deck.\n", game.main_deck.deck_size);
	printf("There are/is currently %d card(s) in the pile.\n", game.main_deck.pile_size);
	printf("\n");
	printf("Top card in the pile: %s %c\n", colors[game.main_deck.pile[game.main_deck.pile_size-1].color], game.main_deck.pile[game.main_deck.pile_size-1].value);
}

void takeTurn(struct game *game) {
	game->players[game->current_turn].uno = false;
	bool UNO;
	bool playedCard = false;
	int index;
	bool draw = false;
	bool hasValidCard = false;
	do {
		index = unoInt("Card Index: ", &UNO);
		if (index < 0 && !draw) {
			for (int i = 0; i < game->players[game->current_turn].hand.hand_size; i++) {
				if (isValidCard(&(game->main_deck), &(game->players[game->current_turn].hand.cards[i]))) {
					hasValidCard = true;
				}
			}
			if (!hasValidCard) {
				draw = true;
			}
		} else if (index < game->players[game->current_turn].hand.hand_size) {
			if (isValidCard(&(game->main_deck), &(game->players[game->current_turn].hand.cards[index]))) {
				game->main_deck.pile[game->main_deck.pile_size++] = handPull(&(game->players[game->current_turn].hand), index);
				playedCard = true;
				break;
			}
		}
	} while (!draw);
	while (draw) {
		if (game->main_deck.deck_size == 0) {
			if (refillDeck(&(game->main_deck)) != 0) {
				handDraw(&(game->main_deck), &(game->players[game->current_turn].hand));
				printCard(&(game->players[game->current_turn].hand.cards[game->players[game->current_turn].hand.hand_size-1]));
			} else {
				break;
			}
		} else {
			handDraw(&(game->main_deck), &(game->players[game->current_turn].hand));
			printCard(&(game->players[game->current_turn].hand.cards[game->players[game->current_turn].hand.hand_size-1]));
		}
		if (isValidCard(&(game->main_deck), &(game->players[game->current_turn].hand.cards[game->players[game->current_turn].hand.hand_size-1]))) {
			if (inputInt("Play Drawn Card (1/0 = Y/N): ") == 1) {
				game->main_deck.pile[game->main_deck.pile_size++] = handPull(&(game->players[game->current_turn].hand), game->players[game->current_turn].hand.hand_size-1);
				playedCard = true;
			}
			draw = false;
		}
	}
	if (game->players[game->current_turn].hand.hand_size == 1 && !UNO) {
		game->players[game->current_turn].uno = true;
	}
	if (UNO) {
		for (int i = 0; i < NUM_PLAYERS; i++) {
			if (game->players[i].uno == true && i != game->current_turn) {
				for (int j = 0; j < UNO_PUNISHMENT; j++) {
					if (game->main_deck.deck_size == 0) {
						if (refillDeck(&(game->main_deck)) != 0) {
							handDraw(&(game->main_deck), &(game->players[i].hand));
						} else {
							break;
						}
					} else {
						handDraw(&(game->main_deck), &(game->players[i].hand));
					}
				}
			}	
		}
	}
	if (playedCard) {
		cardAction(game);
	}
}

struct card handPull(struct hand *hand, int index) {
	struct card pulled_card = hand->cards[index];
	hand->hand_size--;
	for (int i = 0; i < hand->hand_size-index; i++) {
		hand->cards[i+index] = hand->cards[i+index+1];
	}
	return pulled_card;
}

void handDraw(struct deck *deck, struct hand *hand) {
	hand->cards[hand->hand_size++] = draw(deck);
}

int refillDeck(struct deck *deck) {
	int i = 0;
	for ( ; i < deck->pile_size-1; i++) {
		if (deck->pile[i].value == 'C' || deck->pile[i].value == 'P') {
			deck->pile[i].color = 4;
		}
		deck->deck[deck->deck_size++] = deck->pile[i];
	}
	deck->pile[0] = deck->pile[deck->pile_size-1];
	deck->pile_size = 1;
	shuffle(deck);
	return i;
}

void cardAction(struct game *game) {
	int temp_color, draw = 0;
	if (game->main_deck.pile[game->main_deck.pile_size-1].value == 'C' || game->main_deck.pile[game->main_deck.pile_size-1].value == 'P') {
		printColors();
		do {
			temp_color = inputInt("New Color: ");
		} while (temp_color < 0 || temp_color > 3);
		game->main_deck.pile[game->main_deck.pile_size-1].color = temp_color;
	}
	if (game->main_deck.pile[game->main_deck.pile_size-1].value == 'R') {
		if (NUM_PLAYERS > 2) {
			game->order *= -1;
		} else {
			computeTurn(game);
		}
	} else if (game->main_deck.pile[game->main_deck.pile_size-1].value == 'S') {
		computeTurn(game);
	} else if (game->main_deck.pile[game->main_deck.pile_size-1].value == '+' || game->main_deck.pile[game->main_deck.pile_size-1].value == 'P') {
		draw = game->main_deck.pile[game->main_deck.pile_size-1].value == 'P' ? 4 : 2;
	}
	for (int i = 0; i < draw; i++) {
		if (game->main_deck.deck_size == 0) {
			if (refillDeck(&(game->main_deck)) != 0) {
				handDraw(&(game->main_deck), &(game->players[nextPlayer(game)].hand));
			} else {
				break;
			}
		} else {
			handDraw(&(game->main_deck), &(game->players[nextPlayer(game)].hand));
		}
	}
}

int unoInt(char text[], bool *uno) {
	int val, count, i;
	val = count = i = 0;
	char phrase_upper[] = "UNO";
	char phrase_lower[] = "uno";
	printf("%s", text);
	char c = getchar();
	char last = '\0';
	while (!isdigit(c)) {
		if (i <= 2) {
			if (c == phrase_lower[i] || c == phrase_upper[i]) {
				count += 1;
			}
		}
		last = c;
		c = getchar();
		i++;
	}
	while (isdigit(c)) {
		val *= 10;
		val += c-'0';
		c = getchar();
	}
	if (last == '-') {
		val *= -1;
	}
	*uno = count >= 3;
	return val;
}

void printColors(void) {
	for (int i = 0; i < 4; i++) {
		printf("%d = %s, ", i, colors[i]);
	}
	printf("\n");
}

int nextPlayer(struct game *game) {
	if (game->current_turn+game->order < 0) {
		return NUM_PLAYERS-1;
	} else if (game->current_turn+game->order >= NUM_PLAYERS) {
		return 0;
	} else {
		return game->current_turn+game->order;
	}
}

void amogus(void) {
	/*
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣠⣤⣤⣤⣤⣤⣶⣦⣤⣄⡀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⢀⣴⣿⡿⠛⠉⠙⠛⠛⠛⠛⠻⢿⣿⣷⣤⡀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⣼⣿⠋⠀⠀⠀⠀⠀⠀⠀⢀⣀⣀⠈⢻⣿⣿⡄⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⣸⣿⡏⠀⠀⠀⣠⣶⣾⣿⣿⣿⠿⠿⠿⢿⣿⣿⣿⣄⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⣿⣿⠁⠀⠀⢰⣿⣿⣯⠁⠀⠀⠀⠀⠀⠀⠀⠈⠙⢿⣷⡄⠀
⠀⠀⣀⣤⣴⣶⣶⣿⡟⠀⠀⠀⢸⣿⣿⣿⣆⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣿⣷⠀
⠀⢰⣿⡟⠋⠉⣹⣿⡇⠀⠀⠀⠘⣿⣿⣿⣿⣷⣦⣤⣤⣤⣶⣶⣶⣶⣿⣿⣿⠀
⠀⢸⣿⡇⠀⠀⣿⣿⡇⠀⠀⠀⠀⠹⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡿⠃⠀
 ⣸⣿⡇⠀⠀⣿⣿⡇⠀⠀⠀⠀⠀⠉⠻⠿⣿⣿⣿⣿⡿⠿⠿⠛⢻⣿⡇⠀⠀
⠀⠸⣿⣧⡀⠀⣿⣿⡇⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣿⣿⠃⠀⠀
⠀⠀⠛⢿⣿⣿⣿⣿⣇⠀⠀⠀⠀⠀⣰⣿⣿⣷⣶⣶⣶⣶⠶⠀⢠⣿⣿⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⣿⣿⠀⠀⠀⠀⠀⣿⣿⡇⠀⣽⣿⡏⠁⠀⠀⢸⣿⡇⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⣿⣿⠀⠀⠀⠀⠀⣿⣿⡇⠀⢹⣿⡆⠀⠀⠀⣸⣿⠇⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⢿⣿⣦⣄⣀⣠⣴⣿⣿⠁⠀⠈⠻⣿⣿⣿⣿⡿⠏⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠈⠛⠻⠿⠿⠿⠿⠋⠁⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
	*/
}
